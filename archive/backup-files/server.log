
> rest-express@1.0.0 dev
> bash ./scripts/kill-port-5000.sh && NODE_ENV=development tsx server/index.ts

ğŸ”„ Checking for processes on port 5000...
âœ… Port 5000 is free
âœ… Streaming enrichment service initialized
âœ… User context service initialized
âœ… In-memory cache service initialized
âœ… Dashboard controller initialized
âœ… Discover controller initialized
âœ… Search controller initialized
âœ… Content routes initialized with modular controllers
[dotenv@17.2.1] injecting env (24) from .env -- tip: ğŸ“¡ observe env with Radar: https://dotenvx.com/radar
ğŸ—„ï¸ Using SQLite at ./dev.db
[dotenv@17.2.1] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
FIREBASE_ADMIN_KEY present: true
ğŸ” Environment check:
  process.env.NODE_ENV: development
  app.get("env"): development
Firebase Admin SDK initialized successfully
Creating HTTP server
ğŸ—„ï¸ Initializing Enhanced Database Integration Service...
ğŸ—„ï¸ Initializing sqlite database with analytics tables...
âœ… Database Integration Service initialized
âœ… Using MemoryStore for sessions (development mode)
âœ… Firebase authentication system initialized
âœ… All OAuth authentication handled by Firebase client-side
âœ… Database analytics tables initialized successfully
ğŸ“º Viewing History API routes registered
ğŸ¯ User Preferences API routes registered
ğŸ¯ Filter API routes registered
ğŸ§ª A/B Testing routes registered
ğŸ§ª A/B Testing Framework routes registered
ğŸ” About to check environment for Vite setup...
  app.get("env"): "development"
  env length: 11
  env === "development": true
  env.trim() === "development": true
  process.env.NODE_ENV: "development"
âœ… Setting up Vite development server...
3:37:50 PM [express] serving on port 5000
Error: Failed to parse JSON file, invalid JSON syntax found at position 4
    at TransformPluginContext._formatLog (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:42499:41)
    at TransformPluginContext.error (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:42496:16)
    at TransformPluginContext.handler (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:12175:16)
    at EnvironmentPluginContainer.transform (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:42295:19)
    at async file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:37573:22
    at async Promise.all (index 0)
    at async devHtmlHook (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:37565:3)
    at async applyHtmlTransforms (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:36939:17)
    at async file:///workspaces/bingeboard-local/server/vite.ts:1:1358
ğŸ”§ PRE-SESSION: GET /api/auth/session - Session available: false
ğŸ”§ POST-SESSION: GET /api/auth/session - Session available: true, SessionID: DT6iCGkK27HjlZzdrIABIukHfAPHG2kC
ğŸ“‹ GET /api/auth/session
ğŸ“‹ Session ID: DT6iCGkK27HjlZzdrIABIukHfAPHG2kC
ğŸ“‹ Session exists: true
ğŸ“‹ Session data: {
  "cookie": {
    "originalMaxAge": 604799999,
    "expires": "2025-09-22T15:38:03.424Z",
    "secure": false,
    "httpOnly": true,
    "path": "/",
    "sameSite": "lax"
  }
}
ğŸ“‹ Cookie header: bingeboard.session=s%3ADT6iCGkK27HjlZzdrIABIukHfAPHG2kC.m0qPczTIdYVYvU4F8UBr0xzDl5HCfmUFLPXAXaiy96U
ğŸ“‹ req.user in debug middleware: undefined
ğŸ” Session check endpoint called
ğŸ“‹ Session exists: true
ğŸ“‹ Session user: undefined
3:38:03 PM [express] GET /api/auth/session 401 in 10ms :: {"authenticated":false,"message":"No validâ€¦
ğŸ¬ Trending API called: tv/day, includeStreaming: false
ğŸ“Š TMDB returned 20 results
3:38:04 PM [express] GET /api/trending/tv/day 200 in 137ms :: {"page":1,"results":[{"adult":false,"bâ€¦
Error: Failed to parse JSON file, invalid JSON syntax found at position 4
    at TransformPluginContext._formatLog (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:42499:41)
    at TransformPluginContext.error (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:42496:16)
    at TransformPluginContext.handler (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:12175:16)
    at EnvironmentPluginContainer.transform (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:42295:19)
    at async file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:37573:22
    at async Promise.all (index 0)
    at async devHtmlHook (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:37565:3)
    at async applyHtmlTransforms (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:36939:17)
    at async file:///workspaces/bingeboard-local/server/vite.ts:1:1358
ğŸ”§ PRE-SESSION: GET /api/auth/session - Session available: false
ğŸ”§ POST-SESSION: GET /api/auth/session - Session available: true, SessionID: DT6iCGkK27HjlZzdrIABIukHfAPHG2kC
ğŸ“‹ GET /api/auth/session
ğŸ“‹ Session ID: DT6iCGkK27HjlZzdrIABIukHfAPHG2kC
ğŸ“‹ Session exists: true
ğŸ“‹ Session data: {
  "cookie": {
    "originalMaxAge": 604799999,
    "expires": "2025-09-22T15:38:18.157Z",
    "secure": false,
    "httpOnly": true,
    "path": "/",
    "sameSite": "lax"
  }
}
ğŸ“‹ Cookie header: bingeboard.session=s%3ADT6iCGkK27HjlZzdrIABIukHfAPHG2kC.m0qPczTIdYVYvU4F8UBr0xzDl5HCfmUFLPXAXaiy96U
ğŸ“‹ req.user in debug middleware: undefined
ğŸ” Session check endpoint called
ğŸ“‹ Session exists: true
ğŸ“‹ Session user: undefined
3:38:18 PM [express] GET /api/auth/session 401 in 9ms :: {"authenticated":false,"message":"No valid â€¦
ğŸ”§ PRE-SESSION: POST /api/auth/login - Session available: false
ğŸ”§ POST-SESSION: POST /api/auth/login - Session available: true, SessionID: DT6iCGkK27HjlZzdrIABIukHfAPHG2kC
ğŸ“‹ POST /api/auth/login
ğŸ“‹ Session ID: DT6iCGkK27HjlZzdrIABIukHfAPHG2kC
ğŸ“‹ Session exists: true
ğŸ“‹ Session data: {
  "cookie": {
    "originalMaxAge": 604799999,
    "expires": "2025-09-22T15:38:19.358Z",
    "secure": false,
    "httpOnly": true,
    "path": "/",
    "sameSite": "lax"
  }
}
ğŸ“‹ Cookie header: bingeboard.session=s%3ADT6iCGkK27HjlZzdrIABIukHfAPHG2kC.m0qPczTIdYVYvU4F8UBr0xzDl5HCfmUFLPXAXaiy96U
ğŸ“‹ req.user in debug middleware: undefined
ğŸ” Login request received: {
  email: 'rachel.gubin@gmail.com',
  passwordLength: 14,
  body: {
    email: 'rachel.gubin@gmail.com',
    password: 'newpassword123',
    rememberMe: false
  },
  headers: {
    'content-type': 'application/json',
    origin: 'http://localhost:5000',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWeb'
  }
}
ğŸ” Login attempt for email: rachel.gubin@gmail.com
ğŸ‘¤ Found user: {
  id: 'manual_1752272712977_25fdy83s7',
  email: 'rachel.gubin@gmail.com',
  authProvider: 'firebase',
  hasPasswordHash: true
}
ğŸ” Password debug: { providedLength: 14, hashPresent: true, hashSnippet: '$2b$10$bmaJv' }
âœ… Login successful for user: rachel.gubin@gmail.com
âœ… Session saved with user data: rachel.gubin@gmail.com
3:38:19 PM [express] POST /api/auth/login 200 in 89ms :: {"message":"Login successful","user":{"id":â€¦
Error: Failed to parse JSON file, invalid JSON syntax found at position 4
    at TransformPluginContext._formatLog (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:42499:41)
    at TransformPluginContext.error (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:42496:16)
    at TransformPluginContext.handler (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:12175:16)
    at EnvironmentPluginContainer.transform (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:42295:19)
    at async file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:37573:22
    at async Promise.all (index 0)
    at async devHtmlHook (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:37565:3)
    at async applyHtmlTransforms (file:///workspaces/bingeboard-local/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.js:36939:17)
    at async file:///workspaces/bingeboard-local/server/vite.ts:1:1358
ğŸ”§ PRE-SESSION: GET /api/auth/session - Session available: false
ğŸ”§ POST-SESSION: GET /api/auth/session - Session available: true, SessionID: DT6iCGkK27HjlZzdrIABIukHfAPHG2kC
ğŸ“‹ GET /api/auth/session
ğŸ“‹ Session ID: DT6iCGkK27HjlZzdrIABIukHfAPHG2kC
ğŸ“‹ Session exists: true
ğŸ“‹ Session data: {
  "cookie": {
    "originalMaxAge": 604799999,
    "expires": "2025-09-22T15:38:20.880Z",
    "secure": false,
    "httpOnly": true,
    "path": "/",
    "sameSite": "lax"
  },
  "user": {
    "id": "manual_1752272712977_25fdy83s7",
    "email": "rachel.gubin@gmail.com",
    "displayName": "Rachel Gubin",
    "authProvider": "firebase",
    "claims": {
      "sub": "manual_1752272712977_25fdy83s7",
      "email": "rachel.gubin@gmail.com",
      "exp": 1758555499
    }
  }
}
ğŸ“‹ Cookie header: bingeboard.session=s%3ADT6iCGkK27HjlZzdrIABIukHfAPHG2kC.m0qPczTIdYVYvU4F8UBr0xzDl5HCfmUFLPXAXaiy96U
ğŸ“‹ req.user in debug middleware: undefined
ğŸ” Session check endpoint called
ğŸ“‹ Session exists: true
ğŸ“‹ Session user: rachel.gubin@gmail.com
ğŸ” DEBUG - userPreferences object: {
  id: 1,
  userId: 'manual_1752272712977_25fdy83s7',
  preferredGenres: '["Drama","Comedy","Thriller","Romance"]',
  excludedGenres: null,
  preferredLanguages: '["English"]',
  adultContent: 0,
  notificationSettings: '{"email":true,"push":true,"frequency":"weekly"}',
  privacySettings: '{"profileVisible":true,"activityVisible":true}',
  onboardingCompleted: 1,
  createdAt: '2025-08-02 00:21:07',
  updatedAt: '2025-09-07 21:35:55'
}
ğŸ” DEBUG - onboardingCompleted field: 1
ğŸ” DEBUG - typeof onboardingCompleted: number
âœ… Enriched user with onboarding status: true
3:38:21 PM [express] GET /api/auth/session 200 in 9ms :: {"authenticated":true,"user":{"id":"manual_â€¦
ğŸ” [/api/recommendations/unified] Session availability: {
  hasSession: true,
  sessionID: 'DT6iCGkK27HjlZzdrIABIukHfAPHG2kC',
  sessionKeys: [ 'cookie', 'user' ]
}
ğŸ” [/api/recommendations/unified] Session debug: {
  sessionExists: true,
  sessionUser: 'rachel.gubin@gmail.com',
  sessionUserType: 'object',
  sessionHasUser: true,
  fullSession: '{\n' +
    '  "cookie": {\n' +
    '    "originalMaxAge": 604799999,\n' +
    '    "expires": "2025-09-22T15:38:21.094Z",\n' +
    '    "secure": false,\n' +
    '    "httpOnly": true,\n' +
    '    "path": "/",\n' +
    '    "sameSite": "lax"\n' +
    '  },\n' +
    '  "user": {\n' +
    '    "id": "manual_1752272712977_25fdy83s7",\n' +
    '    "email": "rachel.gubin@gmail.com",\n' +
    '    "displayName": "Rachel Gubin",\n' +
    '    "authProvider": "firebase",\n' +
    '    "claims": {\n' +
    '      "sub": "manual_1752272712977_25fdy83s7",\n' +
    '      "email": "rachel.gubin@gmail.com",\n' +
    '      "exp": 1758555499\n' +
    '    }\n' +
    '  }\n' +
    '}'
}
ğŸ” Authentication middleware [/api/recommendations/unified] - Session user: Present
ğŸ” Authentication middleware [/api/recommendations/unified] - Auth header: No auth header
ğŸ” Session user attached to request [/api/recommendations/unified]: rachel.gubin@gmail.com
ğŸ¯ Unified recommendation request received
ğŸ” [/api/recommendations/unified] Session availability: {
  hasSession: true,
  sessionID: 'DT6iCGkK27HjlZzdrIABIukHfAPHG2kC',
  sessionKeys: [ 'cookie', 'user' ]
}
ğŸ” [/api/recommendations/unified] Session debug: {
  sessionExists: true,
  sessionUser: 'rachel.gubin@gmail.com',
  sessionUserType: 'object',
  sessionHasUser: true,
  fullSession: '{\n' +
    '  "cookie": {\n' +
    '    "originalMaxAge": 604799999,\n' +
    '    "expires": "2025-09-22T15:38:21.094Z",\n' +
    '    "secure": false,\n' +
    '    "httpOnly": true,\n' +
    '    "path": "/",\n' +
    '    "sameSite": "lax"\n' +
    '  },\n' +
    '  "user": {\n' +
    '    "id": "manual_1752272712977_25fdy83s7",\n' +
    '    "email": "rachel.gubin@gmail.com",\n' +
    '    "displayName": "Rachel Gubin",\n' +
    '    "authProvider": "firebase",\n' +
    '    "claims": {\n' +
    '      "sub": "manual_1752272712977_25fdy83s7",\n' +
    '      "email": "rachel.gubin@gmail.com",\n' +
    '      "exp": 1758555499\n' +
    '    }\n' +
    '  }\n' +
    '}'
}
ğŸ” Authentication middleware [/api/recommendations/unified] - Session user: Present
ğŸ” Authentication middleware [/api/recommendations/unified] - Auth header: No auth header
ğŸ” Session user attached to request [/api/recommendations/unified]: rachel.gubin@gmail.com
ğŸ¯ Unified recommendation request received
ğŸ” [/api/friends/activity] Session availability: {
  hasSession: true,
  sessionID: 'DT6iCGkK27HjlZzdrIABIukHfAPHG2kC',
  sessionKeys: [ 'cookie', 'user' ]
}
ğŸ” [/api/friends/activity] Session debug: {
  sessionExists: true,
  sessionUser: 'rachel.gubin@gmail.com',
  sessionUserType: 'object',
  sessionHasUser: true,
  fullSession: '{\n' +
    '  "cookie": {\n' +
    '    "originalMaxAge": 604799999,\n' +
    '    "expires": "2025-09-22T15:38:21.094Z",\n' +
    '    "secure": false,\n' +
    '    "httpOnly": true,\n' +
    '    "path": "/",\n' +
    '    "sameSite": "lax"\n' +
    '  },\n' +
    '  "user": {\n' +
    '    "id": "manual_1752272712977_25fdy83s7",\n' +
    '    "email": "rachel.gubin@gmail.com",\n' +
    '    "displayName": "Rachel Gubin",\n' +
    '    "authProvider": "firebase",\n' +
    '    "claims": {\n' +
    '      "sub": "manual_1752272712977_25fdy83s7",\n' +
    '      "email": "rachel.gubin@gmail.com",\n' +
    '      "exp": 1758555499\n' +
    '    }\n' +
    '  }\n' +
    '}'
}
ğŸ” Authentication middleware [/api/friends/activity] - Session user: Present
ğŸ” Authentication middleware [/api/friends/activity] - Auth header: No auth header
ğŸ” Session user attached to request [/api/friends/activity]: rachel.gubin@gmail.com
3:38:21 PM [express] GET /api/friends/activity 200 in 7ms :: {"activities":[{"id":1,"user":{"name":"â€¦
ğŸ¯ Processing unified recommendations: {
  userGenres: 0,
  availableShows: 34,
  excludedShows: 0,
  currentlyWatching: 0,
  mood: 'none'
}
ğŸ¯ Starting unified recommendation generation with filters... {
  filtersApplied: 3,
  availableShows: 34,
  excludeShows: 0,
  defaultLimit: 12,
  sortBy: 'relevance'
}
ğŸ” Applying comprehensive filters... { totalShows: 34, filters: [ 'limit', 'sortBy', 'hideWatched' ] }
ğŸ” Final filtered shows: 34 -> 34
ğŸ¯ Filtered shows: 34 -> 34
ğŸ¤– Fetching AI recommendations...
â„¹ï¸ Sending OpenAI request (attempt 1)... {
  model: 'gpt-4o',
  promptLength: 1444,
  availableShows: 34,
  userGenres: 0
}
ğŸ¬ Fetching TMDB recommendations...
ğŸ“ˆ Fetching trending recommendations...
ğŸ¤ Fetching collaborative filtering recommendations...
â±ï¸ TMDB completed in 1.93ms
ğŸ” Collaborative Filtering Performance: {
  executionTime: '2.67ms',
  recommendationsGenerated: 4,
  similarUsersFound: 3,
  hiddenGemsDiscovered: 0,
  averageConfidence: '78.3%',
  topMatchFactors: [ 'collaborative-filtering', 'similar-users', 'medium-confidence' ]
}
ğŸ¤ Generated 4 collaborative recommendations via AdvancedCollaborativeFiltering
â±ï¸ Collaborative completed in 3.79ms
ğŸ¯ Processing unified recommendations: {
  userGenres: 4,
  availableShows: 34,
  excludedShows: 0,
  currentlyWatching: 0,
  mood: 'none'
}
ğŸ¯ Starting unified recommendation generation with filters... {
  filtersApplied: 3,
  availableShows: 34,
  excludeShows: 0,
  defaultLimit: 12,
  sortBy: 'relevance'
}
ğŸ” Applying comprehensive filters... { totalShows: 34, filters: [ 'limit', 'sortBy', 'hideWatched' ] }
ğŸ” Final filtered shows: 34 -> 34
ğŸ¯ Filtered shows: 34 -> 34
ğŸ¤– Fetching AI recommendations...
âš ï¸ User manual_1752272712977_25fdy83s7 throttled, returning fallback (300s remaining)
â„¹ï¸ Using enhanced fallback recommendation algorithm
ğŸ¬ Fetching TMDB recommendations...
ğŸ“ˆ Fetching trending recommendations...
ğŸ¤ Fetching collaborative filtering recommendations...
â±ï¸ TMDB completed in 0.95ms
â±ï¸ AI completed in 2.11ms
ğŸ” Collaborative Filtering Performance: {
  executionTime: '0.72ms',
  recommendationsGenerated: 4,
  similarUsersFound: 3,
  hiddenGemsDiscovered: 0,
  averageConfidence: '78.3%',
  topMatchFactors: [ 'collaborative-filtering', 'similar-users', 'medium-confidence' ]
}
ğŸ¤ Generated 4 collaborative recommendations via AdvancedCollaborativeFiltering
â±ï¸ Collaborative completed in 1.42ms
3:38:21 PM [express] GET /api/tmdb/discover/tv 200 in 122ms :: {"page":1,"results":[{"adult":false,"â€¦
â±ï¸ Trending completed in 21.47ms
â±ï¸ Trending completed in 20.97ms
ğŸ” Enriching 12 recommendations with details for 12 unique shows
ğŸ” Fetching enhanced details for 12 shows in batches of 5
ğŸ” Successfully enhanced 12/12 shows
âœ… Successfully enriched 12 recommendations with show details
ğŸ¯ Enhanced unified recommendations generated: {
  duration: 134.3813930004835,
  totalRecs: 12,
  sources: { ai: 10, tmdb: 0, trending: 8, collaborative: 4 },
  confidence: '100%',
  filtersUsed: 0
}
3:38:21 PM [express] POST /api/recommendations/unified 200 in 248ms :: {"success":true,"strategy":"uâ€¦
âŒ AI error (attempt 1): 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.
â„¹ï¸ Falling back to heuristic recommendations
â„¹ï¸ Using enhanced fallback recommendation algorithm
â±ï¸ AI completed in 2227.77ms
ğŸ” Enriching 12 recommendations with details for 12 unique shows
ğŸ” Fetching enhanced details for 12 shows in batches of 5
ğŸ” Successfully enhanced 12/12 shows
âœ… Successfully enriched 12 recommendations with show details
ğŸ¯ Enhanced unified recommendations generated: {
  duration: 2297.033406995237,
  totalRecs: 12,
  sources: { ai: 10, tmdb: 0, trending: 8, collaborative: 4 },
  confidence: '100%',
  filtersUsed: 0
}
3:38:23 PM [express] POST /api/recommendations/unified 200 in 2403ms :: {"success":true,"strategy":"â€¦
ğŸ­ Fetching filter genres...
3:38:49 PM [express] GET /api/filters/genres 200 in 4ms :: [{"id":1,"name":"Action"},{"id":2,"name":â€¦
ğŸ“º Fetching streaming platforms...
3:38:59 PM [express] GET /api/filters/platforms 200 in 2ms :: [{"id":8,"name":"Netflix","provider_idâ€¦
