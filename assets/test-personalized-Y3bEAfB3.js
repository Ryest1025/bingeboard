import{u as h,k as g,l as p,j as e}from"./index-DFB8vurI.js";const j=(s,t,o,d)=>{const n=!!(s&&s.preferredGenres&&s.preferredGenres.length>0),c=!!(d&&n&&t!==void 0&&o);return h({queryKey:["/api/ai/recommendations/personalized",s==null?void 0:s.preferredGenres,t==null?void 0:t.length,o==null?void 0:o.id],queryFn:async()=>{var r;if(!n)throw console.log("â³ Waiting for valid preferences..."),new Error("Preferences not yet loaded");console.log("ðŸŽ¯ Fetching personalized AI recommendations with payload:",{genres:s==null?void 0:s.preferredGenres,history:t,user:o==null?void 0:o.id});const l={favoriteGenres:(s==null?void 0:s.preferredGenres)||[],mood:"discover",viewingHistory:t||[],userId:o==null?void 0:o.id,personalizedRequest:!0};console.log("ðŸ¤– AI request payload:",l);try{const i=await fetch("/api/ai/recommendations",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)});if(i.ok){const a=await i.json();return console.log("âœ… Personalized AI recommendations received:",((r=a.recommendations)==null?void 0:r.length)||0,"items"),console.log("ðŸŽ¯ Recommendation source:",a.source),console.log("ðŸ§  AI confidence:",a.confidence),a}throw new Error(`AI recommendations failed: ${i.status}`)}catch(i){throw console.error("âŒ AI recommendations error:",i),i}},enabled:c,staleTime:3e4,refetchOnWindowFocus:!1,retry:2})};function y(){var r,i;const{user:s,isAuthenticated:t}=g(),{data:o}=h({queryKey:["/api/user/preferences"],queryFn:async()=>{const a=await fetch("/api/user/preferences",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch preferences");return a.json()},enabled:!!t}),{data:d}=p(),{data:n,isLoading:c,error:l}=j(o,d,s,t);return t?e.jsxs("div",{className:"p-6 bg-gray-900 text-white",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"ðŸŽ¯ Personalized AI Recommendations Test"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"ðŸ“Š User Data Status:"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsxs("li",{children:["âœ… User: ",s==null?void 0:s.email]}),e.jsxs("li",{children:["ðŸ“‹ Preferences loaded: ",o?"âœ…":"â³"]}),e.jsxs("li",{children:["ðŸŽ¬ Preferred genres: ",((r=o==null?void 0:o.preferredGenres)==null?void 0:r.join(", "))||"Loading..."]}),e.jsxs("li",{children:["ðŸ“º Viewing history: ",d?`âœ… ${d.length} items`:"â³"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"ðŸ¤– AI Recommendations Status:"}),c&&e.jsx("p",{className:"text-yellow-400",children:"â³ Loading personalized recommendations..."}),l&&e.jsxs("p",{className:"text-red-400",children:["âŒ Error: ",l.message]}),n&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-green-400",children:["âœ… Loaded ",((i=n.recommendations)==null?void 0:i.length)||0," personalized recommendations"]}),e.jsxs("p",{className:"text-sm text-gray-300",children:["ðŸŽ¯ Source: ",n.source]}),e.jsxs("p",{className:"text-sm text-gray-300",children:["ðŸ§  Confidence: ",n.confidence]}),e.jsxs("p",{className:"text-sm text-gray-300",children:["ðŸŽ­ AI-powered: ",n.ai?"Yes":"No"]})]})]}),(n==null?void 0:n.recommendations)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"ðŸŽ¬ Your Personalized Recommendations:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:n.recommendations.slice(0,8).map((a,x)=>{var m;return e.jsxs("div",{className:"bg-gray-800 p-3 rounded",children:[e.jsx("div",{className:"text-sm font-semibold",children:a.title}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Score: ",(m=a.score)==null?void 0:m.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Reason: ",a.reason]}),a.matchFactors&&e.jsxs("div",{className:"text-xs text-blue-400 mt-1",children:["ðŸŽ¯ ",a.matchFactors.join(", ")]})]},a.showId||x)})})]})]}):e.jsx("div",{children:"Please log in to see personalized recommendations"})}function f(){return e.jsx("div",{className:"min-h-screen bg-gray-900",children:e.jsx(y,{})})}export{f as default};
