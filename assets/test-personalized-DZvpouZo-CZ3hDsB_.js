import{o as e,U as u,i as h,e as g}from"./index-BPk3_MNU.js";const f=(r,l,n,d)=>{const t=!!(r&&r.preferredGenres&&r.preferredGenres.length>0),a=!!(d&&t&&l!==void 0&&n);return h({queryKey:["/api/ai/recommendations/personalized",r==null?void 0:r.preferredGenres,l==null?void 0:l.length,n==null?void 0:n.id],queryFn:async()=>{var i;if(!t)throw console.log("â³ Waiting for valid preferences..."),new Error("Preferences not yet loaded");console.log("ðŸŽ¯ Fetching personalized AI recommendations with payload:",{genres:r==null?void 0:r.preferredGenres,history:l,user:n==null?void 0:n.id});const c={favoriteGenres:(r==null?void 0:r.preferredGenres)||[],mood:"discover",viewingHistory:l||[],userId:n==null?void 0:n.id,personalizedRequest:!0};console.log("ðŸ¤– AI request payload:",c);try{const o=await fetch("/api/ai/recommendations",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)});if(o.ok){const s=await o.json();return console.log("âœ… Personalized AI recommendations received:",((i=s.recommendations)==null?void 0:i.length)||0,"items"),console.log("ðŸŽ¯ Recommendation source:",s.source),console.log("ðŸ§  AI confidence:",s.confidence),s}throw new Error(`AI recommendations failed: ${o.status}`)}catch(o){throw console.error("âŒ AI recommendations error:",o),o}},enabled:a,staleTime:3e4,refetchOnWindowFocus:!1,retry:2})};function p(){var r,l;const{user:n,isAuthenticated:d}=u(),{data:t}=h({queryKey:["/api/user/preferences"],queryFn:async()=>{const s=await fetch("/api/user/preferences",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch preferences");return s.json()},enabled:!!d}),{data:a}=g(),{data:i,isLoading:c,error:o}=f(t,a,n,d);return d?e.jsxs("div",{className:"p-6 bg-gray-900 text-white",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"ðŸŽ¯ Personalized AI Recommendations Test"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"ðŸ“Š User Data Status:"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsxs("li",{children:["âœ… User: ",n==null?void 0:n.email]}),e.jsxs("li",{children:["ðŸ“‹ Preferences loaded: ",t?"âœ…":"â³"]}),e.jsxs("li",{children:["ðŸŽ¬ Preferred genres: ",((r=t==null?void 0:t.preferredGenres)==null?void 0:r.join(", "))||"Loading..."]}),e.jsxs("li",{children:["ðŸ“º Viewing history: ",a?`âœ… ${a.length} items`:"â³"]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"ðŸ¤– AI Recommendations Status:"}),c&&e.jsx("p",{className:"text-yellow-400",children:"â³ Loading personalized recommendations..."}),o&&e.jsxs("p",{className:"text-red-400",children:["âŒ Error: ",o.message]}),i&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-green-400",children:["âœ… Loaded ",((l=i.recommendations)==null?void 0:l.length)||0," personalized recommendations"]}),e.jsxs("p",{className:"text-sm text-gray-300",children:["ðŸŽ¯ Source: ",i.source]}),e.jsxs("p",{className:"text-sm text-gray-300",children:["ðŸ§  Confidence: ",i.confidence]}),e.jsxs("p",{className:"text-sm text-gray-300",children:["ðŸŽ­ AI-powered: ",i.ai?"Yes":"No"]})]})]}),(i==null?void 0:i.recommendations)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"ðŸŽ¬ Your Personalized Recommendations:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:i.recommendations.slice(0,8).map((s,x)=>{var m;return e.jsxs("div",{className:"bg-gray-800 p-3 rounded",children:[e.jsx("div",{className:"text-sm font-semibold",children:s.title}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Score: ",(m=s.score)==null?void 0:m.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Reason: ",s.reason]}),s.matchFactors&&e.jsxs("div",{className:"text-xs text-blue-400 mt-1",children:["ðŸŽ¯ ",s.matchFactors.join(", ")]})]},s.showId||x)})})]})]}):e.jsx("div",{children:"Please log in to see personalized recommendations"})}function j(){return e.jsx("div",{className:"min-h-screen bg-gray-900",children:e.jsx(p,{})})}export{j as default};
