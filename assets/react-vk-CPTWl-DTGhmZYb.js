import{K as B}from"./index-BPk3_MNU.js";import{X as D}from"./custom-media-element-BTc9lN-c-DnaVW_yH.js";import{c as j,E as b}from"./hls-Gu2pieNd-D912zfQd.js";var V=Object.defineProperty,W=e=>{throw TypeError(e)},_=(e,i,t)=>i in e?V(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,I=(e,i,t)=>_(e,typeof i!="symbol"?i+"":i,t),x=(e,i,t)=>i.has(e)||W("Cannot "+t),E=(e,i,t)=>(x(e,i,"read from private field"),t?t.call(e):i.get(e)),R=(e,i,t)=>i.has(e)?W("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(e):i.set(e,t),C=(e,i,t,p)=>(x(e,i,"write to private field"),i.set(e,t),t),N=(e,i,t)=>(x(e,i,"access private method"),t);const $=e=>{var i,t,p,T,L,k,S;return i=class extends e{constructor(){super(),R(this,T),R(this,t,null),R(this,p,null),R(this,k,()=>{var n,l,f;(n=this.nativeEl)!=null&&n.webkitCurrentPlaybackTargetIsWireless?(l=this.api)==null||l.stopLoad():(f=this.api)==null||f.startLoad()}),N(this,T,S).call(this,"config")}get config(){return E(this,p)}set config(n){C(this,p,n)}attributeChangedCallback(n,l,f){n!=="src"&&super.attributeChangedCallback(n,l,f),n==="src"&&l!=f&&this.load()}async load(){var n,l;const f=!this.api;if(N(this,T,L).call(this),!!this.src){if(f&&!E(this,p)&&C(this,p,JSON.parse(((n=this.shadowRoot.getElementById("config"))==null?void 0:n.textContent)||"{}")),b.isSupported()){switch(this.api=new b({liveDurationInfinity:!0,autoStartLoad:!1,...this.config}),await Promise.resolve(),this.api.loadSource(this.src),this.api.attachMedia(this.nativeEl),this.nativeEl.preload){case"none":{const o=()=>this.api.startLoad();this.nativeEl.addEventListener("play",o,{once:!0}),this.api.on(b.Events.DESTROYING,()=>{this.nativeEl.removeEventListener("play",o)});break}case"metadata":{const o=this.api.config.maxBufferLength,c=this.api.config.maxBufferSize;this.api.config.maxBufferLength=1,this.api.config.maxBufferSize=1;const d=()=>{this.api.config.maxBufferLength=o,this.api.config.maxBufferSize=c};this.nativeEl.addEventListener("play",d,{once:!0}),this.api.on(b.Events.DESTROYING,()=>{this.nativeEl.removeEventListener("play",d)}),this.api.startLoad();break}default:this.api.startLoad()}this.nativeEl.webkitCurrentPlaybackTargetIsWireless&&this.api.stopLoad(),this.nativeEl.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",E(this,k)),C(this,t,document.createElement("source")),E(this,t).setAttribute("type","application/x-mpegURL"),E(this,t).setAttribute("src",this.src),this.nativeEl.disableRemotePlayback=!1,this.nativeEl.append(E(this,t));const v=new WeakMap;this.api.on(b.Events.MANIFEST_PARSED,(o,c)=>{this.nativeEl.autoplay&&this.nativeEl.paused&&this.nativeEl.play().catch(u=>{console.warn("Autoplay failed:",u)}),w();let d=this.videoTracks.getTrackById("main");d||(d=this.addVideoTrack("main"),d.id="main",d.selected=!0);for(const[u,a]of c.levels.entries()){const m=d.addRendition(a.url[0],a.width,a.height,a.videoCodec,a.bitrate);v.set(a,`${u}`),m.id=`${u}`}for(let[u,a]of c.audioTracks.entries()){const m=a.default?"main":"alternative",s=this.addAudioTrack(m,a.name,a.lang);s.id=`${u}`,a.default&&(s.enabled=!0)}}),this.audioTracks.addEventListener("change",()=>{var o;const c=+((o=[...this.audioTracks].find(u=>u.enabled))==null?void 0:o.id),d=this.api.audioTracks.map(u=>u.id);c!=this.api.audioTrack&&d.includes(c)&&(this.api.audioTrack=c)}),this.api.on(b.Events.LEVELS_UPDATED,(o,c)=>{const d=this.videoTracks[this.videoTracks.selectedIndex??0];if(!d)return;const u=c.levels.map(a=>v.get(a));for(const a of this.videoRenditions)a.id&&!u.includes(a.id)&&d.removeRendition(a)});const M=o=>{const c=o.target.selectedIndex;c!=this.api.nextLevel&&(this.api.nextLevel=c)};(l=this.videoRenditions)==null||l.addEventListener("change",M);const w=()=>{for(const o of this.videoTracks)this.removeVideoTrack(o);for(const o of this.audioTracks)this.removeAudioTrack(o)};this.api.once(b.Events.DESTROYING,w);return}await Promise.resolve(),this.nativeEl.canPlayType("application/vnd.apple.mpegurl")&&(this.nativeEl.src=this.src)}}},t=new WeakMap,p=new WeakMap,T=new WeakSet,L=function(){var n,l;(n=E(this,t))==null||n.remove(),(l=this.nativeEl)==null||l.removeEventListener("webkitcurrentplaybacktargetiswirelesschanged",E(this,k)),this.api&&(this.api.detachMedia(),this.api.destroy(),this.api=null)},k=new WeakMap,S=function(n){if(Object.prototype.hasOwnProperty.call(this,n)){const l=this[n];delete this[n],this[n]=l}},I(i,"shadowRootOptions",{...e.shadowRootOptions}),I(i,"getTemplateHTML",(n,l={})=>{const{src:f,...v}=n;return`
        <script type="application/json" id="config">
          ${JSON.stringify(l.config||{})}
        <\/script>
        ${e.getTemplateHTML(v)}
      `}),i},P=$(j(D));globalThis.customElements&&!globalThis.customElements.get("hls-video")&&globalThis.customElements.define("hls-video",P);var F=P,G=new Set(["style","children","ref","key","suppressContentEditableWarning","suppressHydrationWarning","dangerouslySetInnerHTML"]),Y={className:"class",htmlFor:"for"};function H(e){return e.toLowerCase()}function A(e){if(typeof e=="boolean")return e?"":void 0;if(typeof e!="function"&&!(typeof e=="object"&&e!==null))return e}function z({react:e,tagName:i,elementClass:t,events:p,displayName:T,defaultProps:L,toAttributeName:k=H,toAttributeValue:S=A}){const n=Number.parseInt(e.version)>=19,l=e.forwardRef((f,v)=>{var M,w;const o=e.useRef(null),c=e.useRef(new Map),d={},u={},a={},m={};for(const[s,r]of Object.entries(f)){if(G.has(s)){a[s]=r;continue}const h=k(Y[s]??s);if(s in t.prototype&&!(s in(((M=globalThis.HTMLElement)==null?void 0:M.prototype)??{}))&&!((w=t.observedAttributes)!=null&&w.some(y=>y===h))){m[s]=r;continue}if(s.startsWith("on")){d[s]=r;continue}const g=S(r);if(h&&g!=null&&(u[h]=String(g),n||(a[h]=g)),h&&n){const y=A(r);g!==y?a[h]=g:a[h]=r}}if(typeof window<"u"){for(const s in d){const r=d[s],h=s.endsWith("Capture"),g=((p==null?void 0:p[s])??s.slice(2).toLowerCase()).slice(0,h?-7:void 0);e.useLayoutEffect(()=>{const y=o==null?void 0:o.current;if(!(!y||typeof r!="function"))return y.addEventListener(g,r,h),()=>{y.removeEventListener(g,r,h)}},[o==null?void 0:o.current,r])}e.useLayoutEffect(()=>{if(o.current===null)return;const s=new Map;for(const r in m)O(o.current,r,m[r]),c.current.delete(r),s.set(r,m[r]);for(const[r,h]of c.current)O(o.current,r,void 0);c.current=s})}if(typeof window>"u"&&t!=null&&t.getTemplateHTML&&t!=null&&t.shadowRootOptions){const{mode:s,delegatesFocus:r}=t.shadowRootOptions,h=e.createElement("template",{shadowrootmode:s,shadowrootdelegatesfocus:r,dangerouslySetInnerHTML:{__html:t.getTemplateHTML(u,f)}});a.children=[h,a.children]}return e.createElement(i,{...L,...a,ref:e.useCallback(s=>{o.current=s,typeof v=="function"?v(s):v!==null&&(v.current=s)},[v])})});return l.displayName=T??t.name,l}function O(e,i,t){var p;e[i]=t,t==null&&i in(((p=globalThis.HTMLElement)==null?void 0:p.prototype)??{})&&e.removeAttribute(i)}var X=z({react:B,tagName:"hls-video",elementClass:F,toAttributeName(e){return e==="muted"?"":e==="defaultMuted"?"muted":H(e)}});export{X as default};
