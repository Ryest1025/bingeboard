<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Detection Debug</title>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 20px;
            font-size: 16px;
        }
        .container {
            max-width: 100%;
        }
        .debug-info {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #14b8a6;
        }
        .debug-info h3 {
            color: #14b8a6;
            margin-top: 0;
        }
        .debug-info p {
            margin: 5px 0;
            word-break: break-all;
        }
        .button {
            background: #14b8a6;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
        }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: #064e3b; color: #6ee7b7; }
        .error { background: #7f1d1d; color: #fca5a5; }
        .warning { background: #78350f; color: #fbbf24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mobile Detection Debug</h1>
        
        <div class="debug-info">
            <h3>Current Device Info</h3>
            <p id="userAgent">User Agent: Loading...</p>
            <p id="screenSize">Screen Size: Loading...</p>
            <p id="windowSize">Window Size: Loading...</p>
            <p id="deviceType">Device Type: Loading...</p>
            <p id="touchSupport">Touch Support: Loading...</p>
        </div>

        <div class="debug-info">
            <h3>URL Parameters</h3>
            <p id="urlParams">Parameters: Loading...</p>
            <p id="currentUrl">Current URL: Loading...</p>
        </div>

        <div class="debug-info">
            <h3>Detection Tests</h3>
            <p id="mobileRegex">Mobile Regex Test: Loading...</p>
            <p id="serverDetection">Server Detection: Loading...</p>
        </div>

        <button class="button" onclick="testMobileForce()">Test Force Mobile (?mobile=true)</button>
        <button class="button" onclick="testServerDetection()">Test Server Detection</button>
        <button class="button" onclick="refreshDebug()">Refresh Debug Info</button>

        <div id="testResults"></div>
    </div>

    <script>
        function updateDebugInfo() {
            // User Agent
            document.getElementById('userAgent').textContent = 'User Agent: ' + navigator.userAgent;
            
            // Screen and Window Size
            document.getElementById('screenSize').textContent = 'Screen Size: ' + screen.width + 'x' + screen.height;
            document.getElementById('windowSize').textContent = 'Window Size: ' + window.innerWidth + 'x' + window.innerHeight;
            
            // Device Type Detection
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone|Mobile/i.test(navigator.userAgent);
            document.getElementById('deviceType').textContent = 'Device Type: ' + (isMobile ? 'Mobile' : 'Desktop');
            
            // Touch Support
            const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            document.getElementById('touchSupport').textContent = 'Touch Support: ' + (hasTouch ? 'Yes' : 'No');
            
            // URL Parameters
            const urlParams = new URLSearchParams(window.location.search);
            document.getElementById('urlParams').textContent = 'Parameters: ' + (urlParams.toString() || 'None');
            document.getElementById('currentUrl').textContent = 'Current URL: ' + window.location.href;
            
            // Mobile Regex Test
            document.getElementById('mobileRegex').textContent = 'Mobile Regex Test: ' + (isMobile ? 'MOBILE DETECTED' : 'Desktop detected');
            
            // Server Detection Test
            testServerDetectionSilent();
        }

        function testServerDetectionSilent() {
            fetch('/test-mobile')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('serverDetection').textContent = 'Server Detection: ' + 
                        (data.isMobile ? 'MOBILE DETECTED' : 'Desktop detected') + 
                        ' (Server: ' + data.isMobile + ')';
                })
                .catch(error => {
                    document.getElementById('serverDetection').textContent = 'Server Detection: Error - ' + error.message;
                });
        }

        function testMobileForce() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="status warning">Testing force mobile mode...</div>';
            
            // Add mobile=true parameter and reload
            const url = new URL(window.location);
            url.searchParams.set('mobile', 'true');
            window.location.href = url.toString();
        }

        function testServerDetection() {
            const results = document.getElementById('testResults');
            results.innerHTML = '<div class="status warning">Testing server detection...</div>';
            
            fetch('/test-mobile')
                .then(response => response.json())
                .then(data => {
                    results.innerHTML = '<div class="status success">Server Detection Results:</div>' +
                        '<div class="debug-info">' +
                        '<p>Mobile Detected: ' + data.isMobile + '</p>' +
                        '<p>User Agent: ' + data.userAgent + '</p>' +
                        '<p>Timestamp: ' + data.timestamp + '</p>' +
                        '</div>';
                })
                .catch(error => {
                    results.innerHTML = '<div class="status error">Server Detection Error: ' + error.message + '</div>';
                });
        }

        function refreshDebug() {
            updateDebugInfo();
            document.getElementById('testResults').innerHTML = '<div class="status success">Debug info refreshed!</div>';
        }

        // Initialize on page load
        updateDebugInfo();
        
        // Log to console for debugging
        console.log('Mobile Detection Debug Page Loaded');
        console.log('User Agent:', navigator.userAgent);
        console.log('Screen Size:', screen.width + 'x' + screen.height);
        console.log('Window Size:', window.innerWidth + 'x' + window.innerHeight);
        console.log('Touch Support:', 'ontouchstart' in window || navigator.maxTouchPoints > 0);
    </script>
</body>
</html>